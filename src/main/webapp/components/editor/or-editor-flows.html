<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">

<script>
    document.addEventListener("gwtReadyClient", function () {
        Polymer({
            is: 'or-editor-flows',
            behaviors: [openremote.PresenterAware],
            properties: {
                _presenter: {
                    type: Object,
                    value: function () {
                        return new openremote.editor.flow.crud.FlowsPresenter(this);
                    }
                }
            },
            _flowSelected: function (e) {
                this._presenter.loadFlow(e.model.flow.getId());
            },
            _createFlow: function () {
                this._presenter.createFlow();
            },
            _flowDragStart: function (e) {
                e.dataTransfer.setData("flowId", e.model.flow.getId());
                e.dataTransfer.effectAllowed = 'link';
            }
        });
    });
</script>

<dom-module id="or-editor-flows">

    <style>
        :host {
            display: flex;
            flex-direction: column;
            @apply(--or-editor-flows)
        }

        #toolbar {
            flex: 0 0 40px;
            display: flex;
            justify-content: space-around;

            @apply(--or-editor-flows-toolbar)
        }

        #toolbar paper-menu .iron-selected {
            font-weight: inherit;
        }

        #list {
            flex: 1 0 0;
            overflow: auto;
            padding: 0.4em;

            @apply(--or-editor-flows-list);
        }

        #list #empty {
            @apply(--or-editor-flows-list-empty)
        }

        .flow {
            display: inline-block;
            margin: 0.2em;
            padding: 0.4em;
            border-radius: 0.4em;
            background-color: var(--or-editor-flow-item-background-color, white);
            overflow-x: auto;
            cursor: pointer;
        }

        .flow .label {
            color: var(--or-editor-flow-item-label-color, black);
        }

        .flow .label.unlabeled {
            font-style: italic;
        }
    </style>

    <template>

        <div id="toolbar">
            <paper-button on-tap="_createFlow">
                <iron-icon icon="add"></iron-icon>
                NEW FLOW
            </paper-button>
            <paper-menu-button no-animations vertical-offset="20" horizontal-offset="20">
                <paper-button class="dropdown-trigger">
                    <iron-icon icon="menu"></iron-icon>
                    Manage
                </paper-button>
                <paper-menu class="dropdown-content">
                    <div>
                        <paper-button>
                            <iron-icon icon="add"></iron-icon>
                            Do more work
                        </paper-button>
                    </div>
                    <div>
                        <paper-button>
                            <iron-icon icon="delete"></iron-icon>
                            More items...
                        </paper-button>
                    </div>
                </paper-menu>
            </paper-menu-button>
        </div>

        <div id="list">
            <template is="dom-if" if="{{!_presenter.flows.length}}">
                <div id="empty">No flows found.</div>
            </template>
            <template is="dom-repeat" items="[[_presenter.flows]]" as="flow">
                <div class="flow"
                     on-tap="_flowSelected"
                     draggable="[[_presenter.flowEditorVisible]]"
                     on-dragstart="_flowDragStart">
                    <div>
                        <template is="dom-if" if="[[flow.label]]">
                            <span class="label">[[flow.label]]</span>
                        </template>
                        <template is="dom-if" if="[[!flow.label]]">
                            <span class="label unlabeled">Unlabeled Flow</span>
                        </template>
                    </div>
                </div>
            </template>
        </div>
    </template>
</dom-module>

