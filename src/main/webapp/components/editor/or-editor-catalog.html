<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">

<script>
    document.addEventListener("gwtReadyClient", function () {
        Polymer({
            is: 'or-editor-catalog',
            behaviors: [openremote.PresenterAware],
            properties: {
                _presenter: {
                    type: Object,
                    value: function () {
                        return new openremote.editor.catalog.CatalogPresenter(this);
                    }
                }
            },
            _getItemClass: function (item) {
                return "item nodeColor " + item.nodeColor;
            },
            _itemSelected: function (e) {
                // Deselecting all others is a bit difficult...
                var items = this.$.list.querySelectorAll(".item");
                for (var i = 0; i < items.length; i++) {
                    var item = items[i];
                    this.toggleClass("selected", item == e.currentTarget, item);
                }

                this._presenter.itemSelected(e.model.catalogItem);
            },
            _itemDragStart: function (e) {
                e.dataTransfer.setData("nodeType", e.model.catalogItem.nodeType);
                e.dataTransfer.effectAllowed = "copy";
            }
        });
    });
</script>

<dom-module id="or-editor-catalog">

    <style>

        :host {
            display: flex;
            flex-direction: column;
            @apply(--or-editor-catalog)
        }

        #list {
            flex: 1 0 0;
            overflow: auto;

            @apply(--or-editor-catalog-list)
        }

        #list #empty {
            @apply(--or-editor-catalog-list-empty)
        }

        .section {
            padding: 0.4em 0.4em 0 0.4em;
        }

        .category {
        }

        .category .label {
            font-weight: bold;
            cursor: default;
        }

        .item {
            display: inline-block;
            margin: 0.2em;
            padding: 0.4em;
            border-radius: 0.4em;
            background-color: var(--or-editor-flow-item-background-color, white);
            overflow-x: auto;
            cursor: pointer;
        }

        .item.nodeColor.DEFAULT {
            background-color: var(--or-editor-flow-item-nodecolor-default);
        }

        .item.nodeColor.SENSOR_ACTUATOR {
            background-color: var(--or-editor-flow-item-nodecolor-sensor-actuator);
        }

        .item.nodeColor.VIRTUAL {
            background-color: var(--or-editor-flow-item-nodecolor-virtual);
        }

        .item.nodeColor.CLIENT {
            background-color: var(--or-editor-flow-item-nodecolor-client);
        }

        .item .label {
            color: var(--or-editor-flow-item-label-color, black);
        }

        .item.selected {
            background-color: var(--or-editor-flow-item-selected-background-color, black);
        }

        .item.selected .label {
            color: var(--or-editor-flow-item-selected-label-color, white);
        }

    </style>

    <template>
        <div id="list">
            <template is="dom-if" if="{{!_items.length}}">
                <div id="empty">Catalog is empty.</div>
            </template>
            <template is="dom-repeat" items="[[_presenter.categorizedItems]]" as="categorizedItem">
                <div class="section">

                    <div class="category">
                        <span class="label">[[categorizedItem.category.label]]</span>
                    </div>

                    <template is="dom-repeat" items="[[categorizedItem.catalogItems]]" as="catalogItem">
                        <div class$="{{_getItemClass(catalogItem)}}"
                             draggable="true"
                             on-dragstart="_itemDragStart"
                             on-tap="_itemSelected">
                            <span class="label">[[catalogItem.label]]</span>
                        </div>
                    </template>

                </div>
            </template>
        </div>
    </template>

</dom-module>

