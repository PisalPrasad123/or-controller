<link rel="import" href="or-editor-flow-node.html">
<link rel="import" href="or-editor-flow-control.html">

<script>
    document.addEventListener("gwtReadyClient", function () {
        Polymer({
            is: 'or-editor-flow-editor',
            behaviors: [openremote.PresenterAware],
            properties: {
                _presenter: {
                    type: Object,
                    value: function () {
                        return new openremote.editor.flow.editor.FlowEditorPresenter(this);
                    }
                }
            },
            _onDragEnter: function (e) {
                this.toggleClass("dragOver", true, this.$.flowDesigner);
            },
            _onDragLeave: function (e) {
                this.toggleClass("dragOver", false, this.$.flowDesigner);
            },
            _onDragOver: function (e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = "copy";
            },
            _onDrop: function (e) {
                e.preventDefault();
                this.toggleClass("dragOver", false, this.$.flowDesigner);
                var nodeType = e.dataTransfer.getData("text/plain");
                this._presenter.createNode(nodeType, e.offsetX, e.offsetY);
            }
        });
    });
</script>

<dom-module id="or-editor-flow-editor">

    <style>
        :host {
            position: relative;
        }

        :host, #flowDesigner {
            display: block;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #flowDesigner {
        }

        #flowDesigner.dragOver {
            background: radial-gradient(#ccc 0, #ccc 15%, white 15%, white 100%);
            background-origin: padding-box;
            background-clip: border-box;
            background-size: 10px 10px;
        }

        #empty {
            padding: 0.5em;
        }

    </style>

    <template>

        <template is="dom-if" if="{{!_presenter.flow}}">
            <div id="empty">Please select or create a data flow in your inventory.</div>
        </template>

        <div id="flowDesigner"
             on-dragenter="_onDragEnter"
             on-dragleave="_onDragLeave"
             on-dragover="_onDragOver"
             on-drop="_onDrop"></div>

        <or-editor-flow-control id="flowControl"></or-editor-flow-control>

        <or-editor-flow-node id="flowNode"></or-editor-flow-node>

    </template>
</dom-module>

