<link rel="import" href="../ui/or-panel.html">
<link rel="import" href="../ui/or-button.html">
<link rel="import" href="../ui/or-list-section.html">
<link rel="import" href="../ui/or-list-item.html">

<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/av-icons.html">

<script>
    document.addEventListener("gwtReadyClient", function () {
        Polymer({
            is: 'or-inventory-catalog',
            behaviors: [openremote.PresenterAware],
            properties: {
                _presenter: {
                    type: Object,
                    value: function () {
                        return new openremote.shell.inventory.InventoryCatalogPresenter(this);
                    }
                }
            },
            _itemSelected: function (e) {
                // Deselecting all others is a bit difficult...
                var items = this.$.content.querySelectorAll("or-list-item");
                var deselected = false;
                for (var i = 0; i < items.length; i++) {
                    var item = items[i];
                    if (item == e.currentTarget && item.classList.contains("selected")) {
                        this.toggleClass("selected", false, item);
                        deselected = true;
                    } else {
                        this.toggleClass("selected", item == e.currentTarget, item);
                    }
                }

                if (!deselected) {
                    this._presenter.itemSelected(e.model.catalogItem);
                } else {
                    this._presenter.itemDeselected();
                }
            },
            _itemDragStart: function (e) {
                e.dataTransfer.setData("nodeType", e.model.catalogItem.nodeType);
                e.dataTransfer.effectAllowed = "copy";
            }
        });
    });
</script>

<dom-module id="or-inventory-catalog">
    <template>
        <style>
            :host {
                flex: auto;
                -webkit-flex: auto;
                display: flex;
                display: -webkit-flex;
                flex-direction: column;
                -webkit-flex-direction: column;
                overflow: hidden;
            }

            or-list-item.DEFAULT {
                background-color: var(--or-catalog-item-default-background-color);
            }

            or-list-item.SENSOR_ACTUATOR {
                background-color: var(--or-catalog-item-sensoractuator-background-color);
            }

            or-list-item.VIRTUAL {
                background-color: var(--or-catalog-item-virtual-background-color);
            }

            or-list-item.CLIENT {
                background-color: var(--or-catalog-item-client-background-color);
            }

            or-list-item .label {
                color: var(--or-catalog-item-label-color);
            }

            or-list-item.selected {
                background-color: var(--or-catalog-item-selected-background-color);
                box-shadow: 1px 1px 7px 0px rgba(50,50,50,0.75);
            }

            or-list-item.selected .label {
                color: var(--or-catalog-item-selected-label-color);
            }
        </style>

        <or-panel>
            <or-button class="panelTopToolbarItem" icon="av:library-books" on-tap="_openLibrary">Library</or-button>

            <div id="content" class="panelContent">

                <template is="dom-if" if="{{!_presenter.categorizedItems}}">
                    No elements in inventory.
                </template>

                <template is="dom-repeat" items="[[_presenter.categorizedItems]]" as="categorizedItem">
                    <or-list-section label="[[categorizedItem.category.label]]">
                        <template is="dom-repeat" items="[[categorizedItem.catalogItems]]" as="catalogItem">
                            <or-list-item
                                    class$="[[catalogItem.nodeColor]]"
                                    draggable="true"
                                    on-dragstart="_itemDragStart"
                                    on-tap="_itemSelected">
                                <span class="label">[[catalogItem.label]]</span>
                            </or-list-item>
                        </template>
                    </or-list-section>
                </template>

            </div>

        </or-panel>
    </template>
</dom-module>

